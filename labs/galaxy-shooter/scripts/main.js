define("config",[],function(){return{viewport:{width:600,height:800,background:"#000"},background:{width:2,height:2,color:"#fff",count:500,animationCount:5},keys:{enter:"ENTER",pause:"P",left:"ARROW_LEFT",right:"ARROW_RIGHT",up:"ARROW_UP",down:"ARROW_DOWN",shoot:"SPACE"},ship:{red:{width:99,height:75,assets:{"default":"image(images/player-red.png)",left:"image(images/player-red-left.png)",right:"image(images/player-red-right.png)"},particlesColor:"rgb(185, 75, 75) 3px 3px"},green:{width:98,height:50,assets:{"default":"image(images/player-green.png)",left:"image(images/player-green-left.png)",right:"image(images/player-green-right.png)"},particlesColor:"rgb(160, 200, 100) 3px 3px"},lastPosition:{x:-38,y:310},acc:10,lives:3,respawnDelay:2e3},bullet:{width:9,height:33,asset:{red:"image(images/laser-red.png)",green:"image(images/laser-green.png)"},acc:20,shootingInterval:200},asteroid:{small:{width:44,height:42,asset:"image(images/meteor-small.png)",points:20},big:{width:136,height:111,asset:"image(images/meteor-big.png)",points:50},top:-380,spacing:15,minNumber:3,maxNumber:5,minAcc:3,maxAcc:5,chance:.2,maxReplicateNumber:5,generateDelay:3,changeDifficultyDelay:10},ui:{life:{width:35,height:27,asset:{red:"image(images/life-red.png)",green:"image(images/life-green.png)"},y:20,x:20}}}}),define("game",[],function(){return new Engine.Timer({type:Engine.Timer.VSYNC,loop:!0,autoplay:!0})}),define("scene",[],function(){return new Engine.Scene}),define("background",["config","game","scene"],function(e,t,n){var r={};return r.init=function(){var n=this;this.sparkles=[],this.generateSparkles(),t.on("step",function(){for(var t=0;t<e.background.animationCount;t++)n.sparkles[Math.floor(Math.random()*e.background.count)].setOpacity(Math.random())})},r.generateSparkle=function(){this.sparkles.push(new Engine.Geometry.Rectangle({parent:n,width:e.background.width,height:e.background.height,left:Math.round(Math.random()*e.viewport.width)-e.viewport.width/2,top:Math.round(Math.random()*e.viewport.height)-e.viewport.height/2,fill:e.background.color,opacity:Math.random()}))},r.generateSparkles=function(){for(var t=0;t<e.background.count;t++)this.generateSparkle()},r}),define("camera",["scene"],function(e){return new Engine.Camera({lookAt:e})}),define("viewport",["config","camera"],function(e,t){return new Engine.Viewport({width:e.viewport.width,height:e.viewport.height,background:e.viewport.background,id:"game",cameras:[t]})}),define("ui",["config","game","scene"],function(e,t,n){var r={};return r.init=function(t){this.shipColor=t,this.livesIcons=[],this.livesLeft=e.ship.lives,this.score=0,this.updateScore(0),this.drawLives(),this.eventsBound||this.bindEvents()},r.bindEvents=function(){var e=this;this.eventsBound=!0,t.on("shipDestroyed",function(){this.livesLeft?e.drawLives():e.livesIcons.pop().destroy()}),t.on("updateScore",function(t){e.updateScore(t)}),t.on("gameover",function(){e.updateScoreboard()})},r.drawLives=function(){var t=this;while(this.livesIcons.length)this.livesIcons.pop().destroy();for(var r=0;r<this.livesLeft;r++)this.livesIcons.push(new Engine.Geometry.Rectangle({parent:n,width:e.ui.life.width,height:e.ui.life.height,left:-e.viewport.width/2+(e.ui.life.x+r*(e.ui.life.width+10)),top:-e.viewport.height/2+e.ui.life.y,fill:e.ui.life.asset[t.shipColor]}))},r.updateScore=function(e){document.querySelector(".score").innerText=this.score+=e},r.updateScoreboard=function(){if(!window.localStorage)return;var e="scores",t=this.score,n=localStorage.getItem(e)?localStorage.getItem(e).split(",").map(function(e){return parseInt(e,10)}):[];n.push(t),n.sort(function(e,t){return t-e}),n=n.splice(0,5),localStorage.setItem(e,n);var r=document.querySelector(".scores");r.innerHTML="",n.forEach(function(e){e===t?r.innerHTML+='<li class="current"><span>'+e+"</span></li>":r.innerHTML+="<li><span>"+e+"</span></li>"})},r}),define("sounds",[],function(){return{shootBullet:new Engine.Sound({src:"sounds/laser4"}),pressButton:new Engine.Sound({src:"sounds/switch6"}),shipDestroyed:new Engine.Sound({src:"sounds/spaceTrash2"}),shipCreated:new Engine.Sound({src:"sounds/threeTone2"}),asteroidDestroyed:new Engine.Sound({src:"sounds/tone1"})}}),define("asteroids",["config","game","scene","viewport","sounds"],function(e,t,n,r,i){var s={};return s.instances=[],s.init=function(){while(this.instances.length)this.instances.pop().destroy();this.minNumber=e.asteroid.minNumber,this.maxNumber=e.asteroid.maxNumber,this.minAcc=e.asteroid.minAcc,this.maxAcc=e.asteroid.maxAcc,this.generateAsteroids(Math.floor(Math.random()*(this.maxNumber-this.minNumber+1))+this.minNumber),this.eventsBound||this.bindEvents()},s.generateAsteroids=function(t,i){for(var s=0;s<t;s++){var o,u,a,f;i?(o="small",u=i.left+i.width/2,u+=(-Math.round(t/2)+s+1)*e.asteroid[o].width,a=i.top+i.height,f=i.acc+Math.random()*(this.maxAcc-this.minAcc+1)+this.minAcc):(o=Math.random()<e.asteroid.chance?"big":"small",u=Math.random()*e.viewport.width-e.viewport.width/2+e.asteroid.spacing,a=e.asteroid.top,f=Math.random()*(this.maxAcc-this.minAcc+1)+this.minAcc);if(u+e.asteroid[o].width+e.asteroid.spacing>r.width/2){var l=u+e.asteroid[o].width-r.width/2;u=u-l-e.asteroid.spacing}var c=new Engine.Geometry.Rectangle({parent:n,fill:e.asteroid[o].asset,left:u,top:a,width:e.asteroid[o].width,height:e.asteroid[o].height});c.acc=f,c.size=o,this.instances.push(c)}},s.checkOverflow=function(t){t.top>e.viewport.height/2&&(this.instances.remove(t),t.destroy())},s.bindEvents=function(){var n=this,r=0,s=0;this.eventsBound=!0,t.on("loop",function(){(function(){if(++r!==e.asteroid.generateDelay)return;r=0,n.generateAsteroids(Math.floor(Math.random()*(n.maxNumber-n.minNumber+1))+n.minNumber)})(),function(){if(++s!==e.asteroid.changeDifficultyDelay)return;s=0,Math.random()>.5?Math.random()>.5?n.minNumber++:n.maxNumber++:Math.random()>.5?n.minAcc++:n.maxAcc++}()}),t.on("step",function(){n.instances.forEach(function(e){e.setPosition(e.left,e.top+e.acc),n.checkOverflow(e)})}),t.on("asteroidDestroyed",function(t){i.asteroidDestroyed.stop(),i.asteroidDestroyed.play(),t.size==="big"&&n.generateAsteroids(Math.ceil(Math.random()*e.asteroid.maxReplicateNumber),t)}),t.on("asteroidOverflow",function(e){e.destroy()})},s}),define("player",["config","game","scene","viewport","ui","asteroids","sounds"],function(e,t,n,r,i,s,o){var u={};return u.init=function(t){this.bullets=[],this.shipColor=t,this.lastPosition={x:e.ship.lastPosition.x,y:e.ship.lastPosition.y},this.create(),this.eventsBound||this.bindEvents(),this.keysBound||this.bindKeys()},u.create=function(){o.shipCreated.play(),this.speed={x:0,y:0},t.trigger("stopShooting"),new Engine.Geometry.Rectangle({parent:n,name:"ship",width:e.ship[this.shipColor].width,height:e.ship[this.shipColor].height,left:this.lastPosition.x,top:this.lastPosition.y,fill:e.ship[this.shipColor].assets.default}),new Engine.Timer({autoplay:!0,loop:!0,duration:150,iterations:10,on:{play:function(){n.ship.setOpacity(0),n.ship.invincible=!0},loop:function(){this.count%2?n.ship.setOpacity(1):n.ship.setOpacity(0)},stop:function(){n.ship.setOpacity(1),n.ship.invincible=!1}}})},u.checkBulletOverflow=function(t){t.top<-e.viewport.height/2&&(this.bullets.remove(t),t.destroy())},u.bulletAsteroidCollision=function(n,r){Engine.Box.overlap(r.left,r.top,r.width,r.height,n.left,n.top,n.width,n.height)&&(this.bullets.remove(n),n.destroy(),s.instances.remove(r),r.destroy(),t.trigger("asteroidDestroyed",r),t.trigger("updateScore",parseInt(e.asteroid[r.size].points*r.acc/2,10)))},u.playerAsteroidCollision=function(e){if(n.ship===undefined)return;if(n.ship.invincible)return;Engine.Box.overlap(e.left,e.top,e.width,e.height,n.ship.left,n.ship.top,n.ship.width,n.ship.height)&&(this.lastPosition={x:n.ship.left,y:n.ship.top},t.trigger("shipDestroyed",n.ship))},u.bindEvents=function(){var u=this;this.eventsBound=!0,t.on("step",function(){if(n.ship===undefined)return;var e=n.ship.left+r.width/2<0,t=n.ship.left+n.ship.width+r.width/2>r.width,i=n.ship.top+r.height/2<0,s=n.ship.top+n.ship.height+r.height/2>r.height;e?n.ship.setPosition(++n.ship.left,n.ship.top):t?n.ship.setPosition(--n.ship.left,n.ship.top):i?n.ship.setPosition(n.ship.left,++n.ship.top):s?n.ship.setPosition(n.ship.left,--n.ship.top):n.ship.setPosition(n.ship.left+u.speed.x,n.ship.top+u.speed.y)}),t.on("step",function(){u.bullets.forEach(function(t){t.setPosition(t.left,t.top-e.bullet.acc),s.instances.forEach(function(e){u.bulletAsteroidCollision(t,e)}),u.checkBulletOverflow(t)})}),t.on("step",function(){s.instances.forEach(function(e){u.playerAsteroidCollision(e)})}),t.on("startShooting",function(){u.generateBullet(),u.shootingInterval=setInterval(function(){u.generateBullet()},e.bullet.shootingInterval)}),t.on("stopShooting",function(){clearInterval(u.shootingInterval)}),t.on("shipDestroyed",function(n){o.shipDestroyed.play(),i.livesLeft-=1,n.destroy(),i.livesLeft?setTimeout(function(){t.trigger("respawnPlayer")},e.ship.respawnDelay):t.trigger("gameover")}),t.on("respawnPlayer",function(){u.create()})},u.generateBullet=function(){if(n.ship===undefined)return;var t=this,r=new Engine.Geometry.Rectangle({parent:n,fill:e.bullet.asset[t.shipColor],left:n.ship.left+n.ship.width/2-4,top:n.ship.top-35,width:e.bullet.width,height:e.bullet.height});this.bullets.push(r),n.appendChild(r),o.shootBullet.stop(),o.shootBullet.play()},u.bindKeys=function(){var r=this;this.keysBound=!0,Engine.Input.on("keydown",function(i){if(n.ship===undefined)return;switch(i.key){case e.keys.left:r.speed.x-=e.ship.acc,n.ship.setImage(e.ship[r.shipColor].assets.left);break;case e.keys.right:r.speed.x+=e.ship.acc,n.ship.setImage(e.ship[r.shipColor].assets.right);break;case e.keys.up:r.speed.y-=e.ship.acc;break;case e.keys.down:r.speed.y+=e.ship.acc;break;case e.keys.shoot:t.trigger("startShooting")}}),Engine.Input.on("keyup",function(i){if(n.ship===undefined)return;switch(i.key){case e.keys.left:r.speed.x+=e.ship.acc,n.ship.setImage(e.ship[r.shipColor].assets.default);break;case e.keys.right:r.speed.x-=e.ship.acc,n.ship.setImage(e.ship[r.shipColor].assets.default);break;case e.keys.up:r.speed.y+=e.ship.acc;break;case e.keys.down:r.speed.y-=e.ship.acc;break;case e.keys.shoot:t.trigger("stopShooting")}})},u}),require(["config","game","background","player","ui","asteroids","sounds"],function(e,t,n,r,i,s,o){function v(e){f.style.display="none",a.style.display="block",o.pressButton.play(),r.init(e),i.init(e),s.init()}function m(){u.style.display="none",f.style.display="block",l.style.display="none"}function g(){l.style.display="block",a.style.display="none"}var u=document.querySelector(".start-screen"),a=document.querySelector(".ui"),f=document.querySelector(".ship-screen"),l=document.querySelector(".end-screen"),c=document.querySelectorAll(".ship"),h=document.querySelector(".start-game"),p=document.querySelector(".restart-game"),d=document.querySelector(".pause-screen");n.init(),h.addEventListener("click",function(){m()}),[].forEach.call(c,function(e){e.addEventListener("click",function(){v(this.id)})}),p.addEventListener("click",function(){m()}),t.on("gameover",function(){g()}),t.on("pause",function(){d.style.display="block"}),t.on("unpause",function(){d.style.display="none"}),Engine.Input.on("keyup",function(n){switch(n.key){case e.keys.enter:window.getComputedStyle(u).getPropertyValue("display")==="block"||window.getComputedStyle(l).getPropertyValue("display")==="block"?m():window.getComputedStyle(f).getPropertyValue("display")==="block"&&v(document.querySelector(".ship.active").id);break;case e.keys.left:if(window.getComputedStyle(f).getPropertyValue("display")==="none")return;[].forEach.call(c,function(e){e.classList.toggle("active")});break;case e.keys.right:if(window.getComputedStyle(f).getPropertyValue("display")==="none")return;[].forEach.call(c,function(e){e.classList.toggle("active")});break;case e.keys.pause:if(window.getComputedStyle(u).getPropertyValue("display")==="block"||window.getComputedStyle(l).getPropertyValue("display")==="block"||window.getComputedStyle(f).getPropertyValue("display")==="block")return;t.paused?(t.play(),t.paused=!1,t.trigger("unpause")):(t.stop(),t.paused=!0,t.trigger("pause"))}}),window.debugMode=!1,window.log=function(){if(!window.debugMode)return;window.console.log.apply(console,arguments)},window.debugMode&&v("red")}),define("main",function(){});